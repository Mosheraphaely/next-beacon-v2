# Note: Any strings begining with @ or % must be wrapped in quote marks
---
id: signup
title: Signup
isPrimary: true
charts:
  -
    question: How many visitors do we get to the form every day?
    name: compare
    query: "@concat(
              page:view
              ->count(device.spoorId)
              ->filter(page.location.normalizedPath~/signup)
              ->filter(page.location.host~ft.com)
              ->filter(user.geo.isFinancialTimesOffice=false)
              ->filter(page.referrer.host~ft.com)
              ->filter(page.referrer.normalizedPath!~/signup)
              ->interval(d),

              page:view
              ->count()
              ->filter(page.location.normalizedPath~/signup)
              ->filter(page.location.host~ft.com)
              ->filter(user.geo.isFinancialTimesOffice=false)
              ->filter(page.referrer.host~ft.com)
              ->filter(page.referrer.normalizedPath!~/signup)
              ->interval(d)
            )
          ->relabel(_headings,Unique visitors,Pageviews)"
    colspan: 8
    datalabel: Signup success rate
  -
    question: What's our conversion rate this week? (%)
    name: this week's conversion rate
    query: @pct(signup:subscription-created->count()->filter(context.isTestEvent=false)->filter(user.geo.isFinancialTimesOffice=false)->relTime(this_7_days),page:view->count(device.spoorId)->filter(page.location.normalizedPath~/signup)->filter(page.location.host~ft.com)->filter(user.geo.isFinancialTimesOffice=false)->filter(page.referrer.host~ft.com)->filter(page.referrer.normalizedPath!~/signup)->filter(!user.uuid)->relTime(this_7_days))->tidy()
    interval: false
    colspan: 4
    datalabel: weekly conversion rate
  -
    question: What's our weekly conversion rate trend?
    name: weekly conversion rate
    query: "@pct(
        signup:subscription-created->count()->relTime(this_6_weeks),
        page:view->count(device.spoorId)
        ->filter(page.location.normalizedPath~/signup)
        ->filter(page.location.host~ft.com)
        ->filter(user.geo.isFinancialTimesOffice=false)
        ->filter(page.referrer.host~ft.com)
        ->filter(page.referrer.normalizedPath!~/signup)
        ->relTime(this_6_weeks))
        ->tidy()->interval(w)"
    printer: LineChart
  -
    question: How many successful subscriptions have we had?
    name: subscriptions spoor
    interval: false
    query: signup:subscription-created
          ->count()
          ->relTime(this_6_weeks)
          ->filter(context.isTestEvent=false)
          ->filter(user.geo.isFinancialTimesOffice=false)
          ->print(ColumnChart)

    printer: ColumnChart
    colspan: 4
    datalabel: spoor
  -
    question: How many Failed subscription events?
    name: failed
    query: signup:subscription-creation-failed
              ->count()
              ->interval(d)
    printer: StackedColumnChart
    colspan: 4
    datalabel: Signup Browsers
  -
    question: How many bounces have we had today?
    name: bounces
    interval: false
    timeframe: this_1_days
    query: "signup:bounce->count()->filter(context.message.isTestEvent=false)"
    datalabel: Bounces today
    colspan: 3
  -
    question: What are our top browsers?
    name: browsers
    query: page:view
            ->count()
            ->group(device.browserName)
            ->filter(page.location.normalizedPath~/signup)
            ->filter(page.location.host~ft.com)
            ->filter(user.geo.isFinancialTimesOffice=false)
            ->filter(page.referrer.host~ft.com)
            ->filter(page.referrer.normalizedPath!~/signup)
            ->filter(device.browserName)
            ->filter(device.browserName!=false)
            ->sortDesc()
    printer: PieChart
    datalabel: Signup Browsers
    colspan: 5
  -
    question: Existing users trying to subscribe?
    name: exists
    query: signup:notification
            ->count(device.spoorId)
            ->filter(context.message.state=displayed)
            ->filter(context.message.isTestEvent=false)
            ->filter(context.message.type=known subscriber login prompt)
            ->filter(page.location.normalizedPath~/signup)
            ->filter(page.location.host~ft.com)
            ->filter(user.geo.isFinancialTimesOffice=false)
            ->interval(d)
    datalabel: exists
    printer: ColumnChart
    colspan: 4
