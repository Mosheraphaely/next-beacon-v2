# Note: Any strings begining with @ or % must be wrapped in quote marks
---
id: anonymous
title: Anonymous
isPrimary: true
charts:
  -
    question: Are weekly anonymous visitor counts increasing?
    name: weekly
    query: page:view->count(user.ab.allocationId)->filter(!user.uuid)
    timeframe: this_14_weeks
    interval: w
    datalabel: Anonymous visitors per week
  -
    question: Are daily anonymous visitor counts increasing?
    name: daily
    query: page:view->count(user.ab.allocationId)->filter(!user.uuid)
    timeframe: this_4_weeks
    interval: d
    datalabel: Anonymous visitors per day
  -
    question: Which sites are anons visiting from?
    name: referrers
    query: page:view->count(user.ab.allocationId)->filter(!user.uuid)->group(page.referrer.name)->filter(page.referrer.name!~FT)->sortDesc()
    printer: PieChart
    interval: false
  -
    question: Which pages are anons viewing most?
    name: pages
    query: "page:view->count(user.ab.allocationId)->filter(!user.uuid)->group(page.location.path)->top(20)"
    printer: BarChart
    datalabel: "% of anons visting the page"
  -
    question: Which barriers are anons being presented with?
    name: barriers/type
    query: barrier:view->count()->group(context.type)
    colspan: 12 L4
  # -
  #   question: Where are barriers being shown?
  #   name: barriers/where
  #   query: barrier:view->count()->group(context.url)
  -
    question: Are users interacting with barriers
    name: barriers/click-count
    query: "@pct(
      cta:click->count(user.ab.allocationId)->filter(context.domPath~barrier),
      barrier:view->count(user.ab.allocationId)
    )"
    datalabel: pct of users clicking on barriers
    colspan: 12 L4
  - #TODO group by AB test
    question: Are barriers successful at getting users to sign in or subscribe
    name: barriers/click-types
    query: "@concat(
      cta:click->count(user.ab.allocationId)->filter(context.domPath~barrier)->filter(context.domPath!~subscribe)->filter(context.domPath!~sign-in),
      cta:click->count(user.ab.allocationId)->filter(context.domPath~barrier)->filter(context.domPath~subscribe),
      cta:click->count(user.ab.allocationId)->filter(context.domPath~barrier)->filter(context.domPath~sign-in)
    )->relabel(CONCATENATION_RESULT,Other,Subscribe,Sign in)"
    colspan: 12 L4
  -
    question: Are anons clicking on the propensity AB test
    name: propensityAB/clicks
    query: cta:click->count()->filter(context.domPath~propensity-discount)->group(user.ab.tests.propensityAbTest)->tidy()
  -
    question: Are anons in the AB test viewing more pages
    name: propensityAB/page-views
    query: page:view->count()->group(user.ab.tests.propensityAbTest)->tidy()

